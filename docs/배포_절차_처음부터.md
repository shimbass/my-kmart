# GitHub → Render 배포 절차 (처음부터 순서대로)

초보자도 따라 할 수 있도록 **순서대로**만 적었습니다. 위에서부터 1단계씩 진행하면 됩니다.

---

## 준비물 (미리 갖춰두기)

- [ ] GitHub 계정 (없으면 [github.com](https://github.com)에서 가입)
- [ ] Render 계정 (없으면 [render.com](https://render.com)에서 가입, GitHub로 로그인 가능)
- [ ] Supabase 프로젝트 이미 만든 상태 (DB 준비됨)
- [ ] Gemini API 키 (영수증 OCR용)
- [ ] 터미널(또는 VS Code 터미널) 사용 가능

---

# 1단계: GitHub에 코드 올리기

## 1-1. GitHub에서 빈 저장소 만들기

1. [github.com](https://github.com) 로그인
2. 오른쪽 위 **+** → **New repository**
3. **Repository name**: `my-kmart` (원하는 이름)
4. **Public** 선택
5. **"Add a README file"** 체크하지 말고, **Create repository**만 클릭  
   → 빈 저장소가 만들어짐

## 1-2. 저장소 주소 복사

만든 저장소 페이지에서 초록 버튼 **Code** 클릭 후 주소 복사.

- HTTPS 예: `https://github.com/본인아이디/my-kmart.git`
- 본인아이디 부분만 자신의 GitHub 아이디로 바뀐 상태로 복사

## 1-3. 로컬에서 Git 초기화 및 푸시

**프로젝트 폴더**에서 터미널을 연 뒤, 아래를 **한 줄씩** 실행합니다.

```bash
# 1) 프로젝트 폴더로 이동 (경로는 본인 환경에 맞게)
cd /Users/shimmac/Documents/vibecoding-master/Study-01/my-kmart

# 2) Git 저장소로 만들기
git init

# 3) 모든 파일 스테이징 (.env는 .gitignore에 있어서 자동 제외됨)
git add .

# 4) 첫 커밋
git commit -m "Initial commit: K마트 영수증 스캐너"

# 5) GitHub 저장소를 원격(origin)으로 등록 (URL은 1-2에서 복사한 걸로)
git remote add origin https://github.com/본인아이디/my-kmart.git

# 6) 기본 브랜치 이름을 main으로
git branch -M main

# 7) GitHub로 올리기
git push -u origin main
```

- `git push` 시 GitHub 로그인(또는 토큰)을 요구하면 입력
- 끝나면 GitHub 저장소 페이지에서 파일들이 보여야 함

---

# 2단계: 데이터베이스(Supabase) 확인

Render에서 DB를 **새로 만드는 게 아니라**, 이미 만든 **Supabase**에 **연결**만 합니다.

1. [Supabase 대시보드](https://supabase.com/dashboard) 로그인
2. 사용할 프로젝트 선택
3. 왼쪽 **Settings** → **API** 이동
4. 아래 두 값을 메모장에 복사해 두기:
   - **Project URL** → 나중에 `SUPABASE_URL` 로 넣음
   - **anon public** 키 → 나중에 `SUPABASE_KEY` 로 넣음

(이미 `receipts`, `receipt_items` 테이블 만들어 두었다면 그대로 사용하면 됨.)

---

# 3단계: Render에 백엔드 배포

백엔드를 먼저 배포해야, 나중에 프론트엔드에서 쓸 **API 주소**를 얻을 수 있습니다.

## 3-1. Render에서 백엔드 서비스 만들기

1. [dashboard.render.com](https://dashboard.render.com) 로그인
2. **New +** 버튼 클릭 → **Web Service** 선택
3. **Connect a repository**에서 GitHub 계정 연결(처음이면 권한 허용)
4. 저장소 목록에서 **my-kmart** 선택 후 **Connect**

## 3-2. 백엔드 설정 입력

아래 표대로 **한 칸씩** 채웁니다.

| 화면에 보이는 항목 | 넣을 값 |
|-------------------|--------|
| **Name** | `my-kmart-api` (원하는 이름) |
| **Region** | Singapore (또는 가까운 지역) |
| **Root Directory** | `backend` **반드시 입력** |
| **Runtime** | Python 3 |
| **Build Command** | `pip install -r requirements.txt` |
| **Start Command** | `uvicorn app.main:app --host 0.0.0.0 --port $PORT` |

- **Root Directory**를 `backend`로 안 쓰면 빌드가 실패합니다.

## 3-3. 환경 변수 넣기 (백엔드)

같은 화면에서 **Environment** 섹션으로 내려갑니다.

- **Add Environment Variable** 클릭해서 아래 **3개** 추가:

| Key | Value |
|-----|--------|
| `GEMINI_API_KEY` | 본인 Gemini API 키 |
| `SUPABASE_URL` | 2단계에서 복사한 Project URL |
| `SUPABASE_KEY` | 2단계에서 복사한 anon public 키 |

- Value는 **Secret**로 두는 것을 권장 (눈 아이콘으로 숨김 처리 가능).

## 3-4. 배포 실행

- **Create Web Service** 버튼 클릭
- 빌드 로그가 나오고, 끝나면 상단에 **서비스 URL**이 생깁니다.  
  예: `https://my-kmart-api.onrender.com`
- 이 **URL 전체를 복사**해 메모장에 붙여 넣기 (끝에 `/` 없이)

## 3-5. 백엔드 동작 확인

- 브라우저 주소창에 `복사한URL/health` 입력  
  예: `https://my-kmart-api.onrender.com/health`
- `{"status":"healthy", ...}` 같은 JSON이 보이면 성공

---

# 4단계: Render에 프론트엔드 배포

이제 **같은 GitHub 저장소**로 프론트엔드만 따로 배포하고, **3단계에서 받은 백엔드 URL**을 연결합니다.

## 4-1. Render에서 프론트엔드 서비스 만들기

1. Render 대시보드로 돌아가기
2. **New +** → **Static Site** 선택
3. 저장소에서 다시 **my-kmart** 선택 후 **Connect**

## 4-2. 프론트엔드 설정 입력

| 화면에 보이는 항목 | 넣을 값 |
|-------------------|--------|
| **Name** | `my-kmart-web` (원하는 이름) |
| **Root Directory** | `frontend` **반드시 입력** |
| **Build Command** | `npm install && npm run build` |
| **Publish Directory** | `dist` |

- **Root Directory**를 `frontend`로 안 쓰면 빌드가 실패합니다.

## 4-3. 환경 변수 넣기 (프론트엔드)

**Environment**에서 **Add Environment Variable** 클릭 후 **1개**만 추가:

| Key | Value |
|-----|--------|
| `VITE_API_URL` | 3단계에서 복사한 백엔드 URL (예: `https://my-kmart-api.onrender.com`) |

- 반드시 **https**로, **끝에 슬래시(/) 없이** 입력

## 4-4. 배포 실행

- **Create Static Site** 버튼 클릭
- 빌드가 끝나면 **사이트 URL**이 생깁니다.  
  예: `https://my-kmart-web.onrender.com`

## 4-5. 동작 확인

- 위 URL로 접속해서 화면이 뜨는지 확인
- 카메라 촬영 → 이미지 분석까지 되면, 백엔드·DB 연결이 정상인 것입니다.

---

# 5단계: 연결 구조 정리

최종적으로 이렇게 연결됩니다.

```
[사용자]
    ↓
프론트엔드 (Render Static Site)  ← VITE_API_URL 로 백엔드 주소 사용
    ↓
백엔드 (Render Web Service)     ← GEMINI_API_KEY, SUPABASE_URL, SUPABASE_KEY 사용
    ↓
Supabase (데이터베이스)          ← 백엔드가 환경 변수로 연결
```

- **데이터베이스**는 Render에 새로 만드는 게 아니라, Supabase를 백엔드 환경 변수로 **연결**만 한 것입니다.

---

# 자주 나오는 문제

| 증상 | 확인할 것 |
|------|------------|
| `git push` 실패 | GitHub 로그인/토큰, 저장소 URL이 맞는지 |
| 백엔드 빌드 실패 | Root Directory가 `backend`인지 |
| 프론트 빌드 실패 | Root Directory가 `frontend`인지 |
| 프론트에서 API 오류 | `VITE_API_URL`이 백엔드 URL과 똑같은지, 끝에 `/` 없이 |
| 첫 요청이 매우 느림 | 무료 플랜 슬립 모드일 수 있음, 30초~1분 기다려 보기 |

---

# 코드 수정 후 다시 배포하기 (대시보드 등 반영)

이미 1~4단계를 한 번 완료했다면, **대시보드·영수증 목록 등 새로 작성한 코드**를 배포하려면 아래만 하면 됩니다.

1. **로컬에서 변경 사항 커밋 후 GitHub에 푸시**
   ```bash
   cd /Users/shimmac/Documents/vibecoding-master/Study-01/my-kmart
   git add .
   git status   # 올라갈 파일 확인
   git commit -m "대시보드·영수증 목록 UI 개선 반영"
   git push origin main
   ```
2. **Render 동작**
   - Render는 GitHub 저장소와 연결되어 있으면 **푸시할 때마다 자동으로 다시 빌드·배포**합니다.
   - [dashboard.render.com](https://dashboard.render.com) → **my-kmart-api**, **my-kmart-web** 각각 들어가서 **Events** 탭에 최신 배포가 진행 중/완료인지 확인하면 됩니다.
3. **수동 배포가 필요할 때**
   - 서비스 상세 페이지에서 **Manual Deploy** → **Deploy latest commit** 을 눌러도 됩니다.

배포가 끝나면 프론트 URL(예: `https://my-kmart-web.onrender.com`)로 접속해 대시보드·영수증 목록이 반영됐는지 확인하면 됩니다.

---

# 체크리스트 (한 번에 확인)

- [ ] 1단계: GitHub 저장소 만들고, 로컬에서 `git push`까지 완료
- [ ] 2단계: Supabase에서 URL, anon key 복사해 둠
- [ ] 3단계: Render Web Service(백엔드) 배포, URL 복사, `/health` 확인
- [ ] 4단계: Render Static Site(프론트) 배포, `VITE_API_URL`에 백엔드 URL 넣음
- [ ] 5단계: 프론트 URL로 접속해서 촬영·분석 테스트

이 순서만 지키면 GitHub → Render로 백엔드·프론트·DB(Supabase)까지 연결할 수 있습니다.
