# ëŒ€ì‹œë³´ë“œÂ·ì˜ìˆ˜ì¦ ê¸°ëŠ¥ ë¶„ì„ ìš”ì•½

í´ë¡œë“œ ì½”ë“œë¡œ ì¶”ê°€ëœ **ëŒ€ì‹œë³´ë“œ**ì™€ **ì˜ìˆ˜ì¦** ê¸°ëŠ¥ì˜ êµ¬ì¡°ì™€ ë°ì´í„° íë¦„ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

---

## 1. ì „ì²´ êµ¬ì¡° ë³€í™”

### ì´ì „
- ë‹¨ì¼ í˜ì´ì§€: ì¹´ë©”ë¼ â†’ ë¯¸ë¦¬ë³´ê¸° â†’ ì¸ì‹ ê²°ê³¼(ì €ì¥)ë§Œ ì¡´ì¬
- ë¼ìš°íŒ… ì—†ìŒ

### í˜„ì¬
- **3ê°œ í™”ë©´**ìœ¼ë¡œ ë¶„ë¦¬ë˜ê³  **í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜**ìœ¼ë¡œ ì´ë™
- **ìŠ¤ìº”** (ê¸°ì¡´ í”Œë¡œìš°) | **ëŒ€ì‹œë³´ë“œ** (í†µê³„) | **ì˜ìˆ˜ì¦** (ëª©ë¡Â·ìƒì„¸Â·ì‚­ì œ)

```
[ìŠ¤ìº” /]     [ëŒ€ì‹œë³´ë“œ /dashboard]     [ì˜ìˆ˜ì¦ /receipts]
   â”‚                    â”‚                        â”‚
   ScanPage         Dashboard              ReceiptList
   (Camera â†’ Preview â†’ Result)   (ê¸°ê°„ë³„ í†µê³„, ì°¨íŠ¸)   (ëª©ë¡, í•„í„°, ìƒì„¸ ëª¨ë‹¬, ì‚­ì œ)
```

---

## 2. í”„ë¡ íŠ¸ì—”ë“œ ì¶”ê°€Â·ë³€ê²½ ì‚¬í•­

### 2-1. ë¼ìš°íŒ… ë° ê³µí†µ UI

| íŒŒì¼ | ì—­í•  |
|------|------|
| **App.jsx** | `react-router-dom` ë„ì…. `Route`: `/`(ScanPage), `/dashboard`, `/receipts`. í—¤ë” ì œëª©ì„ ê²½ë¡œì— ë”°ë¼ ë³€ê²½. ì „ì²´í™”ë©´ ë²„íŠ¼ ìœ ì§€. |
| **Navigation.jsx** | í•˜ë‹¨ ê³ ì • ë„¤ë¹„ê²Œì´ì…˜. `NavLink`ë¡œ ìŠ¤ìº”(ğŸ“·), ëŒ€ì‹œë³´ë“œ(ğŸ“Š), ì˜ìˆ˜ì¦(ğŸ§¾) ì´ë™. |
| **Navigation.css** | í•˜ë‹¨ ë„¤ë¹„ ìŠ¤íƒ€ì¼. |

### 2-2. ìŠ¤ìº” í”Œë¡œìš° ë¶„ë¦¬

| íŒŒì¼ | ì—­í•  |
|------|------|
| **ScanPage.jsx** | ê¸°ì¡´ Appì˜ ì´¬ì˜Â·ë¯¸ë¦¬ë³´ê¸°Â·ê²°ê³¼Â·ì €ì¥ ë¡œì§ë§Œ í˜ì´ì§€ë¡œ ë¶„ë¦¬. `Camera` â†’ `ImagePreview` â†’ `ResultTable`, `analyzeReceipt` / `saveReceipt` í˜¸ì¶œ. |

- ê¸°ì¡´ `App.jsx`ì— ìˆë˜ ìƒíƒœ/í•¸ë“¤ëŸ¬ê°€ **ScanPage**ë¡œ ì´ë™í•œ í˜•íƒœ.
- ìŠ¤ìº” í›„ ì €ì¥í•˜ë©´ ì˜ìˆ˜ì¦ ëª©ë¡Â·ëŒ€ì‹œë³´ë“œì—ì„œ ë°”ë¡œ ë°˜ì˜ë¨.

### 2-3. ëŒ€ì‹œë³´ë“œ (Dashboard.jsx)

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| **ê¸°ê°„ ì„ íƒ** | `react-datepicker` + date-fns. ì‹œì‘ì¼/ì¢…ë£Œì¼. ë¹ ë¥¸ ë²„íŠ¼: ì´ë²ˆ ë‹¬, ì§€ë‚œ ë‹¬, 3ê°œì›”, ì˜¬í•´. |
| **ìš”ì•½ ì¹´ë“œ** | ê¸°ê°„ ë‚´ **ì´ ì§€ì¶œ**, **ì˜ìˆ˜ì¦ ìˆ˜**, **í‰ê·  ê¸ˆì•¡** (API: `getStats`). |
| **ì›”ë³„ ì§€ì¶œ ì°¨íŠ¸** | `recharts` BarChart. ì›”ë³„ `total_amount` (API: `getMonthlyStats`). |
| **ìƒì ë³„ ì§€ì¶œ** | ìƒì ëª…, ë°©ë¬¸ íšŸìˆ˜, ê¸ˆì•¡, ë¹„ìœ¨. í–‰ í´ë¦­ ì‹œ **í•´ë‹¹ ìƒì ì˜ ì¹´ë“œë³„ ê²°ì œ** í‘œì‹œ (API: `getStoreStats`, `getStoreCardStats`). |
| **ìì£¼ êµ¬ë§¤í•˜ëŠ” ìƒí’ˆ** | í…Œì´ë¸”: ìƒí’ˆëª…, êµ¬ë§¤ íšŸìˆ˜, ì´ ê¸ˆì•¡, í‰ê·  ì£¼ê¸°(ì¼) (API: `getFrequentItems`). |

- API: `getStats`, `getMonthlyStats`, `getStoreStats`, `getFrequentItems`, `getStoreCardStats` (ëª¨ë‘ `start_date`, `end_date` ì‚¬ìš©).

### 2-4. ì˜ìˆ˜ì¦ ëª©ë¡Â·ìƒì„¸ (ReceiptList.jsx)

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| **í•„í„°** | ê¸°ê°„(start_date, end_date), ìƒì (store_name), ì¹´ë“œ(card_name), ìƒí’ˆëª… ê²€ìƒ‰(search). |
| **ëª©ë¡** | ì¹´ë“œ í˜•íƒœ. ë‚ ì§œ ë°°ì§€(ì¼/ì›”), ìƒì ëª…, ì‹œê°„, ì¹´ë“œëª…, ì´ì•¡. í´ë¦­ ì‹œ ìƒì„¸ ëª¨ë‹¬. |
| **ìƒì„¸ ëª¨ë‹¬** | êµ¬ë§¤ì¼ì‹œ, ê²°ì œìˆ˜ë‹¨, ìƒí’ˆ í…Œì´ë¸”(No, ìƒí’ˆëª…, ë‹¨ê°€, ìˆ˜ëŸ‰, ê¸ˆì•¡), ì´ ê²°ì œê¸ˆì•¡. |
| **ì‚­ì œ** | ëª¨ë‹¬ ë‚´ ì‚­ì œ ë²„íŠ¼ â†’ í™•ì¸ í›„ `deleteReceipt` â†’ ëª©ë¡ ê°±ì‹ . |

- API: `getReceipts`(í•„í„° íŒŒë¼ë¯¸í„°), `getReceiptDetail`, `deleteReceipt`.

### 2-5. API í´ë¼ì´ì–¸íŠ¸ (api.js)

| ì¶”ê°€/ë³€ê²½ | ì„¤ëª… |
|-----------|------|
| **getReceipts(params)** | `limit`, `start_date`, `end_date`, `store_name`, `card_name`, `search` ì¿¼ë¦¬ ì§€ì›. |
| **getReceiptDetail(id)** | ì˜ìˆ˜ì¦ 1ê±´ + items ì¡°íšŒ. |
| **deleteReceipt(id)** | DELETE ìš”ì²­. |
| **getStats(start, end)** | `/api/stats/summary` â€” ìš”ì•½. |
| **getMonthlyStats** | `/api/stats/monthly` â€” ì›”ë³„. |
| **getStoreStats** | `/api/stats/by-store` â€” ìƒì ë³„. |
| **getCardStats** | `/api/stats/by-card` â€” ì¹´ë“œë³„ (ëŒ€ì‹œë³´ë“œì—ì„œ ë¯¸ì‚¬ìš© ê°€ëŠ¥). |
| **getFrequentItems(start, end, limit)** | `/api/stats/frequent-items` â€” ìì£¼ êµ¬ë§¤ ìƒí’ˆ. |
| **getStoreCardStats(storeName, start, end)** | `/api/stats/store/{store_name}/cards` â€” ìƒì ë³„ ì¹´ë“œë³„. |

---

## 3. ë°±ì—”ë“œ ì¶”ê°€Â·ë³€ê²½ ì‚¬í•­

### 3-1. API ì—”ë“œí¬ì¸íŠ¸ (main.py)

| ë©”ì„œë“œ | ê²½ë¡œ | ì„¤ëª… |
|--------|------|------|
| GET | `/api/receipts` | ëª©ë¡. ì¿¼ë¦¬: `limit`, `start_date`, `end_date`, `store_name`, `card_name`, `search`. |
| GET | `/api/receipts/{id}` | ìƒì„¸ (receipt + items). |
| DELETE | `/api/receipts/{id}` | ì˜ìˆ˜ì¦ ì‚­ì œ. |
| GET | `/api/stats/summary` | ê¸°ê°„ë³„ ìš”ì•½ (total_amount, receipt_count, avg_amount). |
| GET | `/api/stats/monthly` | ê¸°ê°„ë³„ ì›”ë³„ ì§€ì¶œ. |
| GET | `/api/stats/by-store` | ê¸°ê°„ë³„ ìƒì ë³„ ì§€ì¶œ. |
| GET | `/api/stats/by-card` | ê¸°ê°„ë³„ ì¹´ë“œë³„ ì§€ì¶œ. |
| GET | `/api/stats/frequent-items` | ê¸°ê°„ë³„ ìì£¼ êµ¬ë§¤ ìƒí’ˆ (limit). |
| GET | `/api/stats/store/{store_name}/cards` | íŠ¹ì • ìƒì ì˜ ì¹´ë“œë³„ ì§€ì¶œ. |

### 3-2. DB ì„œë¹„ìŠ¤ (db_service.py)

| í•­ëª© | ì„¤ëª… |
|------|------|
| **get_receipts** | `receipts` í…Œì´ë¸” ì¡°íšŒ í›„, `start_date`/`end_date`(purchase_datetime íŒŒì‹±), `store_name`, `card_name` í•„í„°. `search` ìˆìœ¼ë©´ `items` í…Œì´ë¸”ì—ì„œ ìƒí’ˆëª… `ilike`ë¡œ ê²€ìƒ‰í•´ í•´ë‹¹ receipt_idë§Œ ë‚¨ê¹€. ìµœì‹ ìˆœ ì •ë ¬ í›„ `limit`ë§Œ ë°˜í™˜. |
| **get_receipt_detail** | `receipts` 1ê±´ + `items`(receipt_id) ì¡°íšŒ. |
| **delete_receipt** | `receipts`ì—ì„œ idë¡œ ì‚­ì œ. (Supabaseì—ì„œ items FK cascade ì—¬ë¶€ëŠ” DB ì„¤ì •ì— ë”°ë¦„.) |

- ìƒí’ˆ í•­ëª© í…Œì´ë¸”ëª…: **items** (receipt_id, no, name, barcode, unit_price, quantity, amount).

### 3-3. í†µê³„ ì„œë¹„ìŠ¤ (stats_service.py)

| ë©”ì„œë“œ | ì„¤ëª… |
|--------|------|
| **get_summary** | receipts ì „ë¶€(ë˜ëŠ” ê¸°ê°„ í•„í„°) â†’ ì´ì•¡, ê±´ìˆ˜, í‰ê· . |
| **get_monthly_stats** | ê¸°ê°„ ë‚´ ì˜ìˆ˜ì¦ì„ ì›”ë³„ë¡œ ë¬¶ì–´ ì›”ë³„ total_amount, receipt_count. |
| **get_store_stats** | ê¸°ê°„ ë‚´ ìƒì ë³„ total_amount, visit_count. |
| **get_card_stats** | ê¸°ê°„ ë‚´ ì¹´ë“œë³„ total_amount, usage_count. |
| **get_frequent_items** | ê¸°ê°„ ë‚´ items ì¡°ì¸í•´ ìƒí’ˆëª…ë³„ êµ¬ë§¤ íšŸìˆ˜, ì´ì•¡, í‰ê·  ì¬êµ¬ë§¤ ì£¼ê¸°(ì¼). |
| **get_store_card_stats** | íŠ¹ì • ìƒì  + ê¸°ê°„ ë‚´ ì¹´ë“œë³„ usage_count, total_amount. |

- ë‚ ì§œ í•„í„°: `purchase_datetime` ë¬¸ìì—´ì„ `YY-MM-DD` ë“±ìœ¼ë¡œ íŒŒì‹±í•´ start/endì™€ ë¹„êµ.
- **items** í…Œì´ë¸” ì‚¬ìš©: ìì£¼ êµ¬ë§¤ ìƒí’ˆÂ·ìƒì ë³„ ì¹´ë“œ í†µê³„ì—ì„œ receiptì™€ ì¡°ì¸.

---

## 4. ë°ì´í„° íë¦„ ìš”ì•½

```
[ìŠ¤ìº” í˜ì´ì§€]
  ì´¬ì˜ â†’ OCR(/api/ocr) â†’ ê²°ê³¼ í‘œì‹œ â†’ ì €ì¥(POST /api/receipts)
       â†’ Supabase: receipts 1í–‰ + items Ní–‰

[ëŒ€ì‹œë³´ë“œ]
  ê¸°ê°„ ì„ íƒ â†’ GET /api/stats/summary, monthly, by-store, frequent-items, store/:name/cards
       â†’ receipts + items ê¸°ë°˜ ì§‘ê³„

[ì˜ìˆ˜ì¦]
  ëª©ë¡: GET /api/receipts?start_date&end_date&store_name&card_name&search
  ìƒì„¸: GET /api/receipts/:id  (receipt + items)
  ì‚­ì œ: DELETE /api/receipts/:id
```

---

## 5. ì˜ì¡´ì„± (í”„ë¡ íŠ¸)

- **react-router-dom** â€” ë¼ìš°íŒ…
- **react-datepicker** + **date-fns** â€” ê¸°ê°„ ì„ íƒÂ·í¬ë§·
- **recharts** â€” ëŒ€ì‹œë³´ë“œ ë§‰ëŒ€ ì°¨íŠ¸

(package.jsonì— í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•¨.)

---

## 6. ì •ë¦¬

| êµ¬ë¶„ | ì¶”ê°€ëœ ê¸°ëŠ¥ |
|------|-------------|
| **ë¼ìš°íŒ…** | `/`, `/dashboard`, `/receipts` + í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ |
| **ìŠ¤ìº”** | ê¸°ì¡´ í”Œë¡œìš°ë¥¼ ScanPageë¡œ ë¶„ë¦¬ (ë™ì‘ ë™ì¼) |
| **ëŒ€ì‹œë³´ë“œ** | ê¸°ê°„ë³„ ìš”ì•½Â·ì›”ë³„ ì°¨íŠ¸Â·ìƒì ë³„Â·ìƒì ë³„ ì¹´ë“œë³„Â·ìì£¼ êµ¬ë§¤ ìƒí’ˆ |
| **ì˜ìˆ˜ì¦** | ëª©ë¡(í•„í„°/ê²€ìƒ‰), ìƒì„¸ ëª¨ë‹¬, ì‚­ì œ |
| **ë°±ì—”ë“œ** | ì˜ìˆ˜ì¦ ëª©ë¡/ìƒì„¸/ì‚­ì œ íŒŒë¼ë¯¸í„° í™•ì¥ + stats_service ê¸°ë°˜ í†µê³„ API 6ì¢… |

DBëŠ” ê¸°ì¡´ **receipts** + **items** êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³ , í†µê³„ëŠ” ì„œë²„ì—ì„œ ê¸°ê°„Â·ìƒì Â·ì¹´ë“œÂ·ìƒí’ˆëª… ë‹¨ìœ„ë¡œ ì§‘ê³„í•´ ì œê³µí•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.
