# PRD: 영수증 대시보드

## 1. 개요

### 1.1 목적
저장된 영수증 데이터를 시각화하여 소비 패턴을 분석하고 가계부 관리를 돕는 대시보드 페이지 구현.

### 1.2 대상 사용자
- K마트 영수증 스캐너 앱 사용자
- 가계부 관리 및 소비 패턴 분석이 필요한 사용자

### 1.3 기존 데이터 구조

**receipts 테이블**
| 필드 | 타입 | 설명 |
|------|------|------|
| id | int | PK |
| store_name | string | 상점명 |
| card_name | string | 결제 카드명 |
| purchase_datetime | string | 구매일시 (YY-MM-DD HH:MM) |
| total_amount | int | 총 결제금액 |
| raw_text | text | OCR 원본 텍스트 |
| created_at | timestamp | 저장일시 |

**items 테이블**
| 필드 | 타입 | 설명 |
|------|------|------|
| id | int | PK |
| receipt_id | int | FK (receipts.id) |
| no | string | 상품 번호 |
| name | string | 상품명 |
| barcode | string | 바코드 |
| unit_price | int | 단가 |
| quantity | int | 수량 |
| amount | int | 금액 |

---

## 2. 기능 요구사항

### 2.1 영수증 목록 (Receipt List)

#### 2.1.1 목록 표시
- 저장된 영수증을 **구매일시 기준 최신순** 정렬
- 각 항목에 표시할 정보:
  - 구매일시 (YYYY년 MM월 DD일 HH:MM)
  - 상점명
  - 총 결제금액 (원 단위, 천단위 콤마)
  - 결제 카드명
- 페이지네이션 또는 무한 스크롤 지원

#### 2.1.2 필터링
- 기간 필터 (시작일 ~ 종료일)
- 상점별 필터
- 카드별 필터

#### 2.1.3 검색
- 상품명 키워드 검색

### 2.2 영수증 상세 (Receipt Detail)

#### 2.2.1 상세 정보 표시
- 영수증 클릭 시 모달 또는 슬라이드 패널로 표시
- 표시 내용:
  - 상점명, 구매일시, 결제카드
  - 상품 목록 테이블 (번호, 상품명, 단가, 수량, 금액)
  - 총 결제금액
- 삭제 기능

### 2.3 통계 대시보드 (Statistics)

#### 2.3.1 기간 설정
- 날짜 선택 UI: **달력(캘린더) 피커**
- 시작일/종료일 선택
- 빠른 선택 버튼: 이번 달, 지난 달, 최근 3개월, 올해

#### 2.3.2 월별 지출 현황
- **월별 총 지출 금액** 막대 차트
- **상점별 지출 비율** 파이/도넛 차트
- **카드별 지출 비율** 파이/도넛 차트

#### 2.3.3 상점별 분석
- 상점별 총 지출 금액 순위 (테이블)
- 상점별 방문 횟수
- 상점별 평균 구매 금액

#### 2.3.4 카드별 분석
- 카드별 총 지출 금액 순위
- 카드별 사용 빈도

#### 2.3.5 구매 주기 분석
- **자주 구매하는 상품 TOP 10**
  - 상품명, 총 구매 횟수, 총 구매 금액
- **상품별 평균 구매 주기**
  - 동일 상품의 구매 간격 계산 (일 단위)
  - "평균 N일마다 구매" 형태로 표시
- **재구매 예측**
  - 평균 주기 기반 다음 구매 예상일 표시

### 2.4 추가 인사이트 (Additional Insights)

#### 2.4.1 소비 트렌드
- 전월 대비 지출 증감률 (%)
- 가장 지출이 많았던 날/요일 분석
- 시간대별 구매 패턴 (아침/점심/저녁/야간)

#### 2.4.2 예산 관리 (선택적)
- 월별 예산 설정
- 예산 대비 지출 현황 게이지

#### 2.4.3 상품 가격 추적
- 동일 상품의 가격 변동 히스토리
- 최저가 구매 기록 알림

#### 2.4.4 카테고리 분류 (향후 확장)
- AI 기반 상품 자동 카테고리 분류
- 카테고리별 지출 분석

---

## 3. UI/UX 요구사항

### 3.1 네비게이션
```
┌─────────────────────────────────────┐
│  [스캔] [대시보드] [영수증목록]      │
└─────────────────────────────────────┘
```
- 하단 탭 네비게이션 (모바일)
- 상단 네비게이션 (데스크톱)

### 3.2 대시보드 레이아웃
```
┌─────────────────────────────────────┐
│ 기간 설정: [시작일 📅] ~ [종료일 📅] │
│ [이번달] [지난달] [3개월] [올해]     │
├─────────────────────────────────────┤
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│ │ 총 지출  │ │ 영수증수 │ │ 평균금액 │ │
│ │ ₩00,000 │ │ 00건    │ │ ₩00,000 │ │
│ └─────────┘ └─────────┘ └─────────┘ │
├─────────────────────────────────────┤
│      [월별 지출 막대 차트]           │
├──────────────────┬──────────────────┤
│ [상점별 차트]     │ [카드별 차트]    │
├──────────────────┴──────────────────┤
│      [자주 구매하는 상품 목록]       │
└─────────────────────────────────────┘
```

### 3.3 영수증 목록 레이아웃
```
┌─────────────────────────────────────┐
│ 🔍 상품명 검색...                    │
│ 필터: [기간▼] [상점▼] [카드▼]       │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 2025.02.04 14:30                │ │
│ │ 케이할인마트         ₩25,400    │ │
│ │ 신한카드                    ▶  │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 2025.02.02 11:20                │ │
│ │ 케이할인마트         ₩18,700    │ │
│ │ 하나카드                    ▶  │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 3.4 반응형 디자인
- 모바일 우선 (Mobile-first)
- 브레이크포인트: 768px (태블릿), 1024px (데스크톱)

---

## 4. 기술 요구사항

### 4.1 Frontend

#### 4.1.1 신규 컴포넌트
```
frontend/src/
├── pages/
│   ├── Dashboard.jsx        # 통계 대시보드
│   └── ReceiptList.jsx      # 영수증 목록
├── components/
│   ├── dashboard/
│   │   ├── SummaryCards.jsx      # 요약 카드 (총지출, 영수증수 등)
│   │   ├── MonthlyChart.jsx      # 월별 지출 차트
│   │   ├── StoreChart.jsx        # 상점별 파이 차트
│   │   ├── CardChart.jsx         # 카드별 파이 차트
│   │   ├── FrequentItems.jsx     # 자주 구매 상품
│   │   └── DateRangePicker.jsx   # 기간 선택기
│   ├── receipt/
│   │   ├── ReceiptCard.jsx       # 영수증 카드
│   │   ├── ReceiptDetail.jsx     # 영수증 상세 모달
│   │   └── ReceiptFilters.jsx    # 필터 UI
│   └── common/
│       ├── Navigation.jsx        # 네비게이션
│       └── Calendar.jsx          # 달력 컴포넌트
└── services/
    └── api.js                    # API 함수 추가
```

#### 4.1.2 라이브러리 추가
- **차트**: `recharts` 또는 `chart.js`
- **날짜 피커**: `react-datepicker` 또는 `react-day-picker`
- **라우팅**: `react-router-dom`

### 4.2 Backend

#### 4.2.1 신규 API 엔드포인트

```
GET /api/stats/summary
  - Query: start_date, end_date
  - Response: { total_amount, receipt_count, avg_amount }

GET /api/stats/monthly
  - Query: start_date, end_date
  - Response: [{ month, total_amount, receipt_count }]

GET /api/stats/by-store
  - Query: start_date, end_date
  - Response: [{ store_name, total_amount, visit_count }]

GET /api/stats/by-card
  - Query: start_date, end_date
  - Response: [{ card_name, total_amount, usage_count }]

GET /api/stats/frequent-items
  - Query: start_date, end_date, limit
  - Response: [{ name, purchase_count, total_amount, avg_interval_days }]

GET /api/receipts
  - Query: start_date, end_date, store_name, card_name, search, page, limit
  - Response: { receipts: [], total_count, page, limit }
```

#### 4.2.2 신규 서비스
```
backend/app/services/
└── stats_service.py    # 통계 계산 로직
```

---

## 5. 마일스톤

### Phase 1: 기본 구조 (1-2일)
- [ ] React Router 설정
- [ ] Navigation 컴포넌트
- [ ] 페이지 라우팅 (스캔, 대시보드, 영수증목록)

### Phase 2: 영수증 목록 (2-3일)
- [ ] 영수증 목록 API 확장 (필터, 검색, 페이지네이션)
- [ ] ReceiptList 페이지
- [ ] ReceiptDetail 모달
- [ ] 필터 UI

### Phase 3: 기본 통계 (2-3일)
- [ ] 통계 API 구현
- [ ] DateRangePicker 컴포넌트
- [ ] SummaryCards 컴포넌트
- [ ] 차트 라이브러리 연동

### Phase 4: 상세 통계 (2-3일)
- [ ] 월별/상점별/카드별 차트
- [ ] 자주 구매 상품 분석
- [ ] 구매 주기 계산 로직

### Phase 5: 추가 기능 (선택적)
- [ ] 소비 트렌드 분석
- [ ] 가격 변동 추적
- [ ] 예산 관리 기능

---

## 6. 성공 지표

- 대시보드 페이지 로딩 시간 < 2초
- 통계 데이터 정확도 100%
- 모바일/데스크톱 반응형 지원
- 사용자가 소비 패턴을 한눈에 파악 가능

---

## 7. 제약 사항

- 기존 API 및 데이터베이스 스키마 유지
- 추가 외부 서비스 연동 없음 (Supabase만 사용)
- 인증/로그인 기능 없음 (단일 사용자 가정)
